(()=>{"use strict";let e={isActive:!1,startTime:null,difficulty:null,windowId:null,tabId:null};chrome.runtime.onInstalled.addListener((()=>{chrome.storage.sync.get(["results","settings"],(e=>{e.results||chrome.storage.sync.set({results:[]}),e.settings||chrome.storage.sync.set({settings:{defaultDifficulty:"medium",showTimer:!0}})})),chrome.storage.local.get(["activeTimer","currentSession"],(e=>{e.currentSession||chrome.storage.local.set({currentSession:{startedAt:Date.now(),problems:[]}})}))}));let t=null;chrome.runtime.onMessage.addListener(((s,r,c)=>"START_TIMER"===s.type?(async function(s,r){try{t&&chrome.tabs.sendMessage(t.tabId,{type:"HIDE_TIMER_OVERLAY"}),chrome.tabs.get(s.tabId,(r=>{const c=r.url?(o=r.url).includes("leetcode.com")?"LeetCode":o.includes("hackerrank.com")?"HackerRank":o.includes("codechef.com")?"CodeChef":o.includes("codeforces.com")?"CodeForces":o.includes("atcoder.jp")?"AtCoder":o.includes("geeksforgeeks.org")?"GeeksforGeeks":o.includes("hackerearth.com")?"HackerEarth":"Unknown":"Unknown";var o;t={startTime:Date.now(),difficulty:s.difficulty,windowId:s.windowId,tabId:s.tabId,platform:c},e={isActive:!0,startTime:Date.now(),difficulty:s.difficulty,windowId:s.windowId,tabId:s.tabId},chrome.tabs.sendMessage(s.tabId,{type:"SHOW_TIMER_OVERLAY",difficulty:s.difficulty}),chrome.storage.local.set({activeTimer:t,currentSession:{problems:[{startTime:Date.now(),difficulty:s.difficulty,platform:c,timestamp:Date.now()}],startedAt:Date.now()}})})),r({success:!0})}catch(e){r({success:!1,error:e.message||"Unknown error occurred"})}}(s,c),!0):"END_TIMER"===s.type?(async function(s){try{if(t){const r=Date.now(),c=r-t.startTime;chrome.tabs.sendMessage(t.tabId,{type:"HIDE_TIMER_OVERLAY"}),chrome.storage.sync.get("results",(e=>{const s=e.results||[],o={difficulty:t.difficulty,timeMs:c,platform:t.platform,timestamp:r};s.push(o),chrome.storage.sync.set({results:s},(()=>{chrome.storage.local.get("currentSession",(e=>{const t=e.currentSession;if(t&&t.problems.length>0){const e=t.problems[t.problems.length-1];e.endTime=r,e.timeMs=c,chrome.storage.local.set({currentSession:t})}}))}))})),chrome.storage.local.remove("activeTimer"),chrome.storage.local.get("results",(e=>{const s=e.results||[],o={difficulty:t.difficulty,timeMs:c,platform:t.platform||"Unknown",timestamp:r};s.push(o),chrome.storage.local.set({results:s,lastResult:o,activeTimer:null})})),t=null,e={isActive:!1,startTime:null,difficulty:null,windowId:null,tabId:null},s({success:!0,timeMs:c})}else s({error:"No active timer"})}catch(e){s({success:!1,error:e.message||"Unknown error occurred"})}}(c),!0):"GET_TIMER_STATE"===s.type?(function(e,s){t&&e.tabId===t.tabId?s({isActive:!0,startTime:t.startTime,difficulty:t.difficulty}):s({isActive:!1})}(s,c),!1):void 0)),chrome.storage.onChanged.addListener(((e,t)=>{"sync"===t&&e.results&&console.log("Results updated:",e.results.newValue)})),chrome.windows.onRemoved.addListener((t=>{t===e.windowId&&(e={isActive:!1,startTime:null,difficulty:null,windowId:null,tabId:null})})),chrome.tabs.onRemoved.addListener((t=>{t===e.tabId&&(e={isActive:!1,startTime:null,difficulty:null,windowId:null,tabId:null})})),chrome.tabs.onUpdated.addListener(((e,t,s)=>{"complete"===t.status&&s.url&&(s.url.includes("leetcode.com")||s.url.includes("hackerrank.com")||s.url.includes("codechef.com")||s.url.includes("codeforces.com")||s.url.includes("atcoder.jp")||s.url.includes("geeksforgeeks.org")||s.url.includes("hackerearth.com"))&&chrome.scripting.executeScript({target:{tabId:e},files:["timer-overlay.js"]}).catch(console.error)}))})();