(()=>{"use strict";const t={easy:"#00B8A3",medium:"#FFA116",hard:"#FF375F"},e="#FFFFFF";class n{constructor(){this.startTime=null,this.updateInterval=null,this.isDragging=!1,this.dragOffset={x:0,y:0},this.container=document.createElement("div"),this.timeDisplay=document.createElement("div"),this.dragHandle=document.createElement("div"),this.timeDisplay.textContent="00:00",this.initializeOverlay(),this.initializeDragHandling()}static getInstance(){return n.instance||(n.instance=new n),n.instance}static removeInstance(){n.instance&&(n.instance.hide(),n.instance=null)}initializeOverlay(){const t=document.getElementById("code-clock-overlay");t&&t.remove(),this.container.id="code-clock-overlay",this.container.style.cssText=`\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            background: #282828;\n            color: ${e};\n            padding: 8px 12px;\n            border-radius: 6px;\n            font-family: monospace;\n            font-size: 14px;\n            z-index: 100000;\n            cursor: move;\n            user-select: none;\n            box-shadow: 0 2px 8px rgba(0,0,0,0.3);\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            min-width: 80px;\n            opacity: 0.9;\n            transition: opacity 0.2s;\n        `;const n=document.createElement("div");n.style.cssText="\n            width: 8px;\n            height: 8px;\n            border-radius: 50%;\n            background: #4ade80;\n            animation: pulse 2s infinite;\n        ",this.timeDisplay.style.cssText=`\n            color: ${e};\n            font-weight: 500;\n            flex-grow: 1;\n            text-align: center;\n            font-family: monospace;\n        `,this.container.appendChild(n),this.container.appendChild(this.timeDisplay);const i=document.createElement("button");i.innerHTML="⏹",i.style.cssText=`\n            background: none;\n            border: none;\n            color: ${e};\n            cursor: pointer;\n            padding: 0 4px;\n            font-size: 12px;\n            opacity: 0.7;\n            &:hover {\n                opacity: 1;\n            }\n        `,i.onclick=t=>{t.stopPropagation(),this.handleStop()},this.container.appendChild(i),document.body.appendChild(this.container)}initializeDragHandling(){this.container.addEventListener("mousedown",this.startDragging.bind(this)),document.addEventListener("mousemove",this.drag.bind(this)),document.addEventListener("mouseup",this.stopDragging.bind(this))}startDragging(t){if(t.target===this.container){this.isDragging=!0;const e=this.container.getBoundingClientRect();this.dragOffset={x:t.clientX-e.left,y:t.clientY-e.top}}}drag(t){if(!this.isDragging)return;const e=t.clientX-this.dragOffset.x,n=t.clientY-this.dragOffset.y,i=window.innerWidth-this.container.offsetWidth,s=window.innerHeight-this.container.offsetHeight;this.container.style.left=`${Math.min(Math.max(0,e),i)}px`,this.container.style.top=`${Math.min(Math.max(0,n),s)}px`,this.container.style.right="auto"}stopDragging(){this.isDragging=!1}handleClick(t){this.isDragging||confirm("Do you want to stop the timer?")&&chrome.runtime.sendMessage({type:"END_TIMER"})}handleStop(){confirm("End the timer?")&&chrome.runtime.sendMessage({type:"END_TIMER"})}formatTime(t){const e=Math.floor(t/6e4),n=Math.floor(t%6e4/1e3);return`${String(e).padStart(2,"0")}:${String(n).padStart(2,"0")}`}show(e){this.startTime=Date.now(),this.container.style.display="flex",this.container.style.borderLeft=`3px solid ${t[e]}`,this.container.style.opacity="0.9",this.timeDisplay.textContent="00:00",this.updateTimer(),this.updateInterval=window.setInterval((()=>this.updateTimer()),1e3),this.container.offsetHeight}updateTimer(){if(!this.startTime)return;const t=Date.now()-this.startTime;this.timeDisplay.textContent=this.formatTime(t)}hide(){this.updateInterval&&clearInterval(this.updateInterval),this.container.style.display="none",this.startTime=null;const t=Date.now(),e=t-(this.startTime||t);chrome.storage.local.get("activeTimer",(n=>{n.activeTimer&&chrome.storage.local.set({lastTimerResult:{timeMs:e,difficulty:n.activeTimer.difficulty,timestamp:t}})})),this.container.getBoundingClientRect(),chrome.storage.local.set({timerPosition:{top:this.container.style.top,left:this.container.style.left}})}}n.instance=null,n.getInstance(),window.addEventListener("unload",(()=>{n.removeInstance()})),chrome.runtime.onMessage.addListener(((t,e,i)=>("SHOW_TIMER_OVERLAY"===t.type?requestAnimationFrame((()=>{n.getInstance().show(t.difficulty)})):"HIDE_TIMER_OVERLAY"===t.type&&(n.getInstance().hide(),n.removeInstance()),!0)))})();